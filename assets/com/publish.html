<html>
<style>
    @import url("/styles.css");
    :host {
        display: block;
    }
</style>
<script type="module">
    import { urlFor, getAuth } from "/lib/apptron.js";

    $("#publish-form").addEventListener("submit", async (e) => {
        e.preventDefault();
        const project = component.context.project;
        const tokenParam = { token: (await getAuth()).getSessionToken() };
        await fetch(urlFor(`/projects/${encodeURIComponent(project.name)}`, tokenParam, window.session.claims.username), {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ publish_source: $("#publish-source").value })
        });
        window.modal.finish();
    });
</script>
<form id="publish-form" method="dialog" class="dialog">
<div class="dialog-header">
    <h2>Public</h2>
    <button class="dialog-close" onclick="window.modal.close()" type="button">&times;</button>
</div>
<div class="dialog-body">
    <label for="publish-source">Source</label>
    <input id="publish-source" name="publish-source" type="text" value="public" pattern="[A-Za-z][A-Za-z0-9_\-]{1,23}"
      oninput="this.value = this.value.replace(/[^A-Za-z0-9_\-]/g, '')"
      title="Names can only contain letters, numbers, dashes, and underscores" required />

    <label for="publish-url">Publish URL</label>
    <input id="publish-url" type="text" value="https://progrium.aptn.pub/foobar" spellcheck="false" />
</div>

<div class="dialog-footer">
    <button class="btn" type="button" onclick="window.modal.finish()">Cancel</button>
    <button class="btn primary" id="project-submit" type="submit">Publish</button>
</div>
</form>
</html>