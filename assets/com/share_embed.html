<html>
<style>
    @import url("/styles.css");
    :host {
        display: block;
    }
</style>
<script type="module">
    import { urlFor, getAuth, copyText, currentURL, envUsername, isLocalhost } from "/lib/apptron.js";
    const { project } = component?.context || {};

    async function embedSource() {
        // not much to it, the current url in an iframe
        return `<iframe src="${await currentURL()}"></iframe>`;
    }


    // -------------------------------------------------------
    // TAB INITIALIZATION
    // -------------------------------------------------------
    queueMicrotask(() => init())

    async function init() {

        $("#copy").addEventListener("click", async () => {
            const ok = await copyText($("#embed-src").value || "");
            const oldText = $("#copy").textContent;
            $("#copy").textContent = ok ? "Copied!" : "Copy failed";
            setTimeout(() => ($("#copy").textContent = oldText), 1200);
        });

        $("#embed-src").value = await embedSource();

    }

    
</script>

<form id="embed-form" method="dialog" class="dialog">
<div class="dialog-body">
    <label for="embed-src">Embed HTML</label>
    <textarea id="embed-src" name="embed-src" spellcheck="false"></textarea>
</div>

<div class="dialog-footer">
    <div style="flex-grow: 2;">
        <button id="copy" type="button" class="btn secondary">Copy Source</button>
    </div>
    <button class="btn secondary" type="button" onclick="window.modal.finish()">Done</button>
</div>
</form>

</html>