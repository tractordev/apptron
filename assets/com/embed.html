<html>
<style>
    @import url("/styles.css");
    :host {
        display: block;
    }
</style>

<script type="module">
    import { urlFor, getAuth, copyText, currentURL, envUsername, isLocalhost } from "/lib/apptron.js";
    const { project } = component?.context || {};

    async function publishURL() {
        const username = await envUsername();
        // todo: dont hardcode the publish domain for prod
        const publicURL = `${username}.aptn.pub/${project.name}`;
        if (isLocalhost()) {
            return `http://${window.location.host}/${publicURL}`;
        }
        return `https://${publicURL}`;
    }


    // -------------------------------------------------------
    // TAB INITIALIZATION
    // -------------------------------------------------------
    queueMicrotask(() => init())

    async function init() {

        // Simple tab navigation between modals
        $("#tab-share").addEventListener("click", () => {
            window.modal.show("/com/share", { project });
        });

        $("#tab-embed").addEventListener("click", () => {
            /* already here, do nothing */
        });

        $("#tab-publish").addEventListener("click", () => {
            window.modal.show("/com/publish", { project });
        });

        $("#copy").addEventListener("click", async () => {
            const ok = await copyText($("#embed-src").value || "");
            const oldText = $("#copy").textContent;
            $("#copy").textContent = ok ? "Copied!" : "Copy failed";
            setTimeout(() => ($("#copy").textContent = oldText), 1200);
        });

        // $("#embed-src").value = await publishURL();

    }

    
</script>

<div class="dialog-tabs">
    <button id="tab-share" class="dialog-tab btn">Share</button>
    <button id="tab-publish" class="dialog-tab btn">Publish</button>
    <button id="tab-embed"   class="dialog-tab dialog-tab-active btn">Embed</button>
</div>

<form id="embed-form" method="dialog" class="dialog">
<div class="dialog-header">
    <h2>Embed</h2>
    <button class="dialog-close btn icon-btn" onclick="window.modal.close()" type="button">&times;</button>
</div>
<div class="dialog-body">
    <label for="embed-src">Embed HTML</label>
    <textarea id="embed-src" name="embed-src" spellcheck="false"></textarea>
</div>

<div class="dialog-footer">
    <div style="flex-grow: 2;">
        <button id="copy" type="button" class="btn secondary">Copy Source</button>
    </div>
    <button class="btn secondary" type="button" onclick="window.modal.finish()">Done</button>
</div>
</form>

</html>